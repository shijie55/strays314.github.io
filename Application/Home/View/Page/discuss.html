<extend name="./Public/home/index.html"/>
<block name="title"><title>{:C('SITE_TITLE')}</title></block>
<block name="banner">
    <!--#banner-->
    <section class="clearfix"><img src="{$banner}" class="img-responsive"></section>
</block>
<block name="main">
    <!--#main-->
    <section class="clearfix bgea pad-v-md">

        <include file="Public/navbar"/>

        <div class="clearfix pad-sm visible-lg"></div>
        <div class="container clearfix">
            <div class="row">

                <include file="Public/sidenav"/>

                <div class="col-lg-11s  col-md-12 mydiscuss">
                    <div class="clearfix topic-act-box">
                        <a href="javascript:void(0);" class="btn btn-grn btn-md pubDis">发表话题</a>
                    </div>
                    <div class="clearfix topic-lis-box">
                        <volist name="discuss" id="vo">
                            <div class="item-item">
                                <a href="javascript:void(0);" class="t">
                                    <div class="hidden myID">{$vo['id']}</div>
                                    {$vo['title']}</a>

                                <div class="clearfix ion-lis">
                                    <table>
                                        <tr>
                                            <td><i class="ion">&#xe66e;</i></td>
                                            <td>{$vo['uip']}</td>
                                            <td class="pad-l-xs"><i class="ion">&#xe66c;</i></td>
                                            <td>{$vo['addtime']}</td>
                                            <td class="pad-l-xs"><i class="ion">&#xe66d;</i></td>
                                            <td>{$vo['pname']}</td>
                                            <td class="pad-l-xs"><i class="ion">&#xe66b;</i></td>
                                            <td>{$vo['dnum']}</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </volist>
                        <div class="clearfix pad"></div>
                    </div>
                    <div class="page bg">
                        <div></div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            $(function () {
                // 加载话题发布界面
                $('.pubDis').click(function () {
                    var addstr = '<div class="clearfix topic-lis-box"><form role="form" class="pad-v">';
                    addstr += '<div class="form-group"><label for="nickname">昵称</label>';
                    addstr += ' <input type="text" class="form-control" id="nickname" placeholder="请输入昵称"></div>';
                    addstr += '<div class="form-group"><label for="title">主题</label>';
                    addstr += '<input type="email" class="form-control" id="title" placeholder="请输入话题标题"></div>';
                    addstr += '<div class="form-group"><label for="content">内容</label>';
                    addstr += '<textarea class="form-control" id="content" placeholder="请输入内容" rows="4"></textarea></div>';
                    addstr += '<button type="button" class="btn btn-grn" onclick="addtopic()">发表话题</button></form></div>';
                    $('.mydiscuss').html(addstr);
                });
                // 进入话题
                $('.t').click(function (id) {
                    var id = parseInt($(this).find('.myID').text());
                    $.ajax({
                        type: "post",
                        url: "{:U('Discuss/getDisInfo')}",
                        data: {'id': id},
                        datatype: "json",
                        success: function (data) {
                            $('.mydiscuss').html(data);
                        },
                        error: function () {
                            alert('查询失败');
                        }
                    })
                });
            });
            // 添加评论
            function reptopic() {
                var nickname = $.trim($('#nickname').val());
                var tid = parseInt($('.tId').text());
                // alert(tid);
                var content = $.trim($('#content').val());
                if (nickname == '') {
                    alert('昵称必须填写');
                    $('#nickname').focus();
                    return false;
                } else if (content == '') {
                    alert('内容必须填写');
                    $('#content').focus();
                    return false;
                }
                ;
                $.ajax({
                    url: "{:U('Discuss/addComment')}",
                    type: "POST",
                    data: {'uname': nickname, 'tid': tid, 'content': content},
                    success: function (d) {
                        if (d == 'ok') {
                            alert('回复成功');
                            location.reload();
                        } else {
                            alert('回复失败');
                        }
                    }
                });
            }
            ;
            // 添加话题
            function addtopic() {
                var nickname = $.trim($('#nickname').val());
                var title = $.trim($('#title').val());
                var content = $.trim($('#content').val());
                if (nickname == '') {
                    alert('昵称必须填写');
                    $('#nickname').focus();
                    return false;
                } else if (title == '') {
                    alert('标题必须填写');
                    $('#title').focus();
                    return false;
                } else if (content == '') {
                    alert('内容必须填写');
                    $('#content').focus();
                    return false;
                }
                $.ajax({
                    url: "{:U('Discuss/add')}",
                    type: "POST",
                    data: {'pname': nickname, 'title': title, 'content': content},
                    success: function (d) {
                        if (d == 'ok') {
                            alert('话题发表成功');
                            location.reload();
                        } else {
                            alert('话题发表失败');
                            location.reload();
                        }
                        ;
                    }
                });
            }
            ;
        </script>
    </section>
</block>